<!DOCTYPE html>
<html>
  
  <head>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width, initial-scale=1"
    />

    <!-- CSS Stylesheet -->
    <link href="/bulma/css/bulma.css" rel="stylesheet" type="text/css" />

    <!-- Scripts -->
    <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
    <script src="scripts/formchecks.js"></script>

  </head>

  <body>
    <div class="content is-max-desktop">
      <h1>Sign up form</h1>
      <div class="container" style="width: 50%">

        <form action="/register" method="POST" onsubmit="registration()"> 

          <p class="control has-icons-left">
            <input class="input" type="text" name="firstname" id="firstname" placeholder="firstname"/>
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:account-circle"></iconify-icon>
            </span>
          </p>

          <p id = "errorfirstname" style="color:red;"></p>
          

          <p class="control has-icons-left">
            <input class="input" type="text" name="lastname" id="lastname" placeholder="lastname"/>
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:account-circle-outline"></iconify-icon>
            </span>
          </p>

          <p id = "errorlastname" style="color:red;"></p>
          
          <p class="control has-icons-left">
            <input class="input" type="text" name="email" id="email" placeholder="email" />
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:email-outline"></iconify-icon>
            </span>
          </p>

          <p id = "erroremail" style="color:red;"></p>


          <p class="control has-icons-left">
            <input class="input" type="number" name="age" id="age" placeholder="age" />
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:calendar-month"></iconify-icon>
            </span>
          </p>

          <p id = "errorage" style="color:red;"></p>
          
          <label class="label" for="diagnosis-dropdown">Select Diagnosis:</label>
          <div class="select">
            <select name="diabetic" id="diabetic" required>
              <option></option>
              <option value="true">Diabetic</option>
              <option value="false">Non-Diabetic</option>
            </select>
          </div>
          
          <p></p>
          
          <p class="control has-icons-left">
            <input class="input" type="text" name="username" id="username" placeholder="username"/>
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:rename-box"></iconify-icon>
            </span>
          </p>

          <p id = "errorusername" style="color:red;"></p>
          
          <p class="control has-icons-left">
            <input class="input" type="text" name="password" id="password" placeholder="password"/>
            <span class="icon is-left">
              <iconify-icon data-icon="mdi:key-variant"></iconify-icon>
            </span>
          </p>

          <p id = "errorpassword" style="color:red;"></p>

          
          <button class="button is-primary is-rounded">Create Account</button> 

          <br>
          <br>

          <p id = "errorpassword" style="color:red;">Debug: <%= locals.error %></p> <!--debug-->
          
        </form>
      </div>
    </div>

    



    <a href="/login"><button class="button">Login</button></a>
    <a href="/"><button class="button">Back</button></a>








    <script>
      /*
      Passport local mongoose
      ============================
      MissingPasswordError 'No password was given'
      AttemptTooSoonError 'Account is currently locked. Try again later'
      TooManyAttemptsError 'Account locked due to too many failed login attempts'
      NoSaltValueStoredError 'Authentication not possible. No salt value stored'
      IncorrectPasswordError 'Password or username are incorrect'
      IncorrectUsernameError 'Password or username are incorrect'
      MissingUsernameError 'No username was given'
      UserExistsError 'A user with the given username is already registered'


      custom (email)
      ===============================
      Email is taken.
      */

      var error = "<%- locals.error %>";
      
      var emailInput = document.getElementById('email');
      var usernameInput = document.getElementById('username');
      var passwordInput = document.getElementById('password')

      var erroremail = document.getElementById("erroremail");
      var errorusername = document.getElementById("errorusername");
      var errorpassword = document.getElementById("errorpassword")

      //email
      if (error == "Email is taken."){
        emailInput.className = "input is-danger";
        erroremail.innerHTML = "Email is taken.";
      } 
      

      //username
      if (error == "MissingUsernameError: No username was given"){
        usernameInput.className = "input is-danger";
        errorusername.innerHTML = "No username was given.";
      } 
      if(error == "UserExistsError: A user with the given username is already registered"){
        usernameInput.className = "input is-danger";
        errorusername.innerHTML = "Username is already registered."
      }


    </script>


  </body>
</html>
