<!DOCTYPE html>
<html>
  <head>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width, initial-scale=1"
    />

    <!-- Scripts -->
    <script src="/chart.js/dist/Chart.min.js"></script>
    <script src="/chartjs-plugin-annotation/chartjs-plugin-annotation.min.js"></script>
    <script src="scripts/formchecks.js"></script>

    <!-- CSS Stylesheets -->
    <link href="css/dashboard.css" rel="stylesheet" type="text/css" />
    <link href="/bulma/css/bulma.css" rel="stylesheet" type="text/css" />
  
  
  </head>
  
  <div class="navbar1">
    
    <div class="dropdown1">
      
      <button class="dropbtn1" ><%= username %> </button>
      <div class="dropdown-content1">
          <a href="/logout">Sign Out</a>
          
      </div>
    </div>
  </div>

  <br>

  <body>
    <div class="content is-max-desktop">
      <div class="container" style="width: 50%">
        <form action="/dashboard" method="POST" onsubmit="dashboard()">
          <input
            class="input"
            id="glucoseInput"
            type="text"
            name="glucoselevel"
            placeholder="glucoselevel"
          />

          <button class="button" >Submit</button>
        </form>

        <canvas id="myChart"></canvas>
      </div>
    </div>

    <img src="images/BloodDrop.png" />


    
    
    <script >
    
      // ChartJS only works inside of script tags in the html/ejs annoying
      // Get JSON data being sent back on POST
    
      var timestamps = [];
      var jsonObject =  '<%- JSON.stringify(data, null, 0)%>';
      jsonObject = JSON.parse(jsonObject);
      var jsonFirstName = jsonObject['firstname'];
      var jsonGluLength = jsonObject['glucoselevels'].length;
      var jsonGlucose = [];

      if (jsonObject['diabetic'] == true) {
        var topAnnotation = 180;
        var topAnnotationText = "High Value (diabetic)";
        var btmAnnotationText = "Low Value (diabetic)";
      }
      else {
        var topAnnotation = 140;
        var topAnnotationText = "High Value (non-diabetic)";
        var btmAnnotationText = "Low Value (non-diabetic)";
      }

      for (i = 0; i < jsonGluLength; i++) {
        jsonGlucose.push(parseFloat(jsonObject['glucoselevels'][i]));
        timestamps.push(jsonObject['timestamps'][i]);
      }
      //Display chart
      var ctx = document.getElementById("myChart").getContext("2d");
      var myChart = new Chart(ctx, {
        // The type of chart we want to create
        type: "line",
        // The data for our dataset
        data: {
          labels: timestamps,
          datasets: [
            {
              label: "Glucose mg/dL",
              fill: false,
              borderColor: "rgb(255, 99, 132)",
              data: jsonGlucose,
            },
          ],
        },
        // Configuration options go here
        options: {
          title: {
            display: true,
            text: "Blood Glucose Chart"
          },
          annotation: {
            annotations: [
              {
                id: 'btmLine',
                type: 'line',
                mode: 'horizontal',
                scaleID: 'y-axis-0',
                value: 50,
                borderColor: 'red',
                borderWidth: 2, 
                borderDash: [4, 8], 
                label: {
                  backgroundColor: "red",
                  content: btmAnnotationText,
                  enabled: true,
                  yAdjust: -10
                }
              }, {
                id: 'topLine',
                type: 'line',
                mode: 'horizontal',
                scaleID: 'y-axis-0',
                value: topAnnotation,
                borderColor: 'red',
                borderWidth: 2,
                borderDash: [4, 8],
                label: {
                  backgroundColor: "red",
                  content: topAnnotationText,
                  enabled: true,
                  yAdjust: 10
                }
              }
            ]
          }
        },
      });
      
    </script>




  </body>
</html>

